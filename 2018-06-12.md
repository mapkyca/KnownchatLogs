* <a id="11:13.53">11:13.53 (BST)</a> - __[mapkyca](https://github.com/mapkyca)__: jeremycherfas: Got an example of this happening? Known will use the mime type of the original image, so either the original file was mis-detected on upload (prob because your server mime types aren't configured or the mime type hint library isn't installed), or headers are being squished on download
* <a id="11:37.33">11:37.33 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Let me check. It definitely happens with images from OwnYourGram, like this one https://stream.jeremycherfas.net/2018/result
* <a id="11:37.56">11:37.56 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Let me see if I have one uploaded directly
* <a id="11:39.42">11:39.42 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Allso true with other images via Micropub, eg https://stream.jeremycherfas.net/2018/untitled-13
* <a id="11:43.00">11:43.00 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: But not, apparently, with images uploaded directly to Known, e.g. https://stream.jeremycherfas.net/2018/breadhead
* <a id="11:43.50">11:43.50 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Seems that when they come from somewhere else, image files do not get an extension, but when I upload them direct to Known, they do.
* <a id="11:57.33">11:57.33 (BST)</a> - __[[kevinmarks]](https://github.com/[kevinmarks])__: so mime type is not coming through in micropub? Both multipart and media endpoint should be sending it
* <a id="12:04.30">12:04.30 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: I guess not. I need to go and check my setting in Quill (and OYG?) to see if that is an option I have overlooked. But not for an hour or so.
* <a id="12:04.58">12:04.58 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Seems odd. Maybe Known's micropub is stripping it.
* <a id="14:14.49">14:14.49 (BST)</a> - __[mapkyca](https://github.com/mapkyca)__: aye, possibly the micropub endpoint isn't setting mime correctly...
* <a id="14:35.52">14:35.52 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: I'm looking here https://github.com/idno/Known/blob/master/IdnoPlugins/IndiePub/Pages/MicroPub/Endpoint.php#L122 but 'type' seems to refer to the type of post, not the type of file.
* <a id="14:44.44">14:44.44 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Nope. More likely to be here https://github.com/idno/Known/blob/master/IdnoPlugins/IndiePub/Pages/MicroPub/Endpoint.php#L588
* <a id="14:56.42">14:56.42 (BST)</a> - __[mapkyca](https://github.com/mapkyca)__: depends if it's a direct file upload or a json payload uploading the image via url. File upload should be fairly robust as that will take the mime from the browser reported content-type, but downloading via url depends on the remote server reporting the content type correctly...
* <a id="15:23.41">15:23.41 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: I see. So need to look at what the remote server sends. Although I am not seeing anywhere in `endpoint.php` where $mimetype is added to filename as an extension. Or maybe it doesn't need to be.
* <a id="15:32.30">15:32.30 (BST)</a> - __[mapkyca](https://github.com/mapkyca)__: Mime is stored in the file store metadata, not as a file extension
* <a id="15:37.55">15:37.55 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Let me try for the final image as Known saves it.
* <a id="15:38.02">15:38.02 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Bingo `Content-Type: application/data`
* <a id="15:39.03">15:39.03 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: !tell mapkyca When quill uploads the image to the temp storage, it is `Content-Type: image/jpeg`
* <a id="15:39.03">15:39.03 (BST)</a> - __[Loqi](https://github.com/Loqi)__: Ok, I'll tell them that when I see them next
* <a id="15:39.12">15:39.12 (BST)</a> - __[aaronpk](https://github.com/aaronpk)__: i've seen this problem a lot in Known. it often tricks my avatar cache into saving files with the wrong extension because my cache looks at the mime type when it downloads the file
* <a id="15:39.41">15:39.41 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: But when I look at the image link directly, it is `Content-Type: application/data`
* <a id="15:39.46">15:39.46 (BST)</a> - __[aaronpk](https://github.com/aaronpk)__: jeremycherfas: so just to double check, the sequence to reproduce this was:
* <a id="15:40.01">15:40.01 (BST)</a> - __[aaronpk](https://github.com/aaronpk)__: 1) quill -> Known media endpoint: file is saved at the media endpoint with image/jpeg
* <a id="15:40.07">15:40.07 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Go to post a photo note in Quill.
* <a id="15:40.23">15:40.23 (BST)</a> - __[aaronpk](https://github.com/aaronpk)__: 2) quill -> Known Micropub endpoint JSON, tells Known the media endpoint URL: Known then copies the file and serves as application/data
* <a id="15:40.44">15:40.44 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: When the image preview is showing and Quill shows the link, do `curl -I link-to-tempfile'
* <a id="15:40.56">15:40.56 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Content-Type: image/jpeg
* <a id="15:41.07">15:41.07 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Post the photo to Known.
* <a id="15:41.18">15:41.18 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Copy the link of the image as shown by Known.
* <a id="15:41.33">15:41.33 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Do `curl -I link-to-image`
* <a id="15:41.43">15:41.43 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Content-Type: application/data
* <a id="15:42.39">15:42.39 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: So not quite. The image saved at the media endpoint is temporary. Known then saves it permanently elsewhere.
* <a id="15:42.45">15:42.45 (BST)</a> - __[aaronpk](https://github.com/aaronpk)__: great
* <a id="15:42.58">15:42.58 (BST)</a> - __[aaronpk](https://github.com/aaronpk)__: hopefully mapkyca can track this down with that information
* <a id="15:43.41">15:43.41 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: I hope so. Is it worth my writing up? I can create an issue and stick it on my website.
* <a id="17:15.14">17:15.14 (BST)</a> - __[[cleverdevil]](https://github.com/[cleverdevil])__: Hmm. Interesting. Tag me on the bug on GitHub too please. I may have a chance to take a look at some point.
* <a id="17:21.58">17:21.58 (BST)</a> - __[jeremycherfas](https://github.com/jeremycherfas)__: Not exactly sure how to do that, so here's the link https://github.com/idno/Known/issues/2097
* <a id="17:22.00">17:22.00 (BST)</a> - __[Loqi](https://github.com/Loqi)__: [jeremycherfas] <a href="https://github.com/idno/Known/issues/2097">#2097</a> MIME type not attached to photos from Micropub
